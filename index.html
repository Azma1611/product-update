<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turmeric Market Tracker</title>
<style>
body {
  margin:0; font-family: Arial, sans-serif; background:#f2f2f2;
}
.app {
  width: 100%;
  max-width: 480px;
  margin: 0 auto;
  padding: 15px;
  min-height: 100vh;
  background: #fff;
  box-sizing: border-box;
}
h2 {text-align:center; margin-bottom:15px;}
textarea {
  width:100%; height:120px; font-size:16px; padding:12px; margin-bottom:10px; border-radius:10px; border:1px solid #ccc; resize:none; box-sizing:border-box;
}
button {
  width:100%; padding:14px; font-size:16px; border:none; border-radius:10px; margin-bottom:10px; cursor:pointer; transition:0.2s;
}
button:active { transform:scale(0.97); }
#playBtn{background:#28a745;color:#fff;}
#historyBtn{background:#007bff;color:#fff;}
.animation-box{min-height:150px;margin:10px 0;padding:5px 0;}
.history-box{margin-top:10px;}
.item-box{
  display:flex; justify-content:space-between; align-items:center;
  background:#fff; border-radius:12px; padding:16px; margin-bottom:12px;
  width:100%; box-sizing:border-box; box-shadow:0 3px 8px rgba(0,0,0,0.15); position:relative;
  transition:0.2s;
}
.item-box:hover{transform:translateY(-2px);}
.item-data{display:flex; flex-direction:column; flex:1;}
.item-data span{margin:2px 0; font-size:16px; color:#333;}
.up{color:green;font-weight:bold;}
.down{color:red;font-weight:bold;}
.menu{position:relative;}
.menu-btn{font-size:24px; cursor:pointer; padding:0 10px; user-select:none;}
.menu-content{display:none; position:absolute; right:0; top:28px; background:#fff; border:1px solid #ccc; border-radius:8px; min-width:130px; box-shadow:0 3px 6px rgba(0,0,0,0.2); z-index:10;}
.menu-content button{width:100%; padding:10px 12px; background:none; border:none; text-align:left; cursor:pointer; font-size:15px; color:#333; transition:0.2s;}
.menu-content button:hover{background:#f2f2f2;}
@keyframes fadeInUp{from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);}}
.animate-row{animation:fadeInUp 0.6s ease forwards;}
</style>
</head>
<body>
<div class="app">
<h2>Turmeric Market Tracker</h2>
<textarea id="input" placeholder="Paste new data here"></textarea>
<button id="playBtn">â–¶ Play</button>
<button id="historyBtn">ðŸ“œ View History</button>
<div id="animation" class="animation-box"></div>
<div id="history" class="history-box"></div>
</div>
<script>
const playBtn=document.getElementById("playBtn");
const historyBtn=document.getElementById("historyBtn");
const animationBox=document.getElementById("animation");
const historyDiv=document.getElementById("history");

// Example initial data (your WhatsApp data)
const initialData=[
  {market:"PERUNDURAI REGULATED MARKET", date:"08_01_2026", item:"Finger", old:9569, new:16089},
  {market:"PERUNDURAI REGULATED MARKET", date:"08_01_2026", item:"Bulb", old:8569, new:14499},
  {market:"ERODE REGULATED MARKET", date:"08.01.2026", item:"Finger", old:8999, new:16369},
  {market:"ERODE REGULATED MARKET", date:"08.01.2026", item:"Bulb", old:8469, new:14599},
  {market:"ERODE SOCIETY", date:"08.01.2026", item:"Finger", old:9999, new:16099},
  {market:"ERODE SOCIETY", date:"08.01.2026", item:"Bulb", old:9499, new:14479}
];

// Play animation using array of items
function playAnimationData(data){
  animationBox.innerHTML="";
  data.forEach((entry,index)=>{
    setTimeout(()=>{
      let status="âž–", cls="";
      if(entry.new>entry.old){status="ðŸ”¼ Increase"; cls="up";}
      else if(entry.new<entry.old){status="ðŸ”½ Decrease"; cls="down";}
      const div=document.createElement("div");
      div.className="item-box animate-row";
      div.innerHTML=`
      <div class="item-data">
        <span><b>Market:</b> ${entry.market}</span>
        <span><b>Date:</b> ${entry.date}</span>
        <span><b>Item:</b> ${entry.item}</span>
        <span><b>Old:</b> ${entry.old}</span>
        <span><b>New:</b> ${entry.new}</span>
        <span class="${cls}"><b>Status:</b> ${status}</span>
      </div>
      <div class="menu">
        <span class="menu-btn" onclick="toggleMenu(this)">â‹®</span>
        <div class="menu-content">
          <button onclick="deleteEntry('${entry.market}','${entry.item}')">Delete</button>
          <button onclick="deleteAllHistory()">Delete All History</button>
        </div>
      </div>
      `;
      animationBox.appendChild(div);
    },index*800);
  });
}

// MENU
function toggleMenu(element){
  const menu=element.nextElementSibling;
  menu.style.display=(menu.style.display==="block")?"none":"block";
}

// DELETE ENTRY
function deleteEntry(market,item){
  const boxes=animationBox.getElementsByClassName("item-box");
  for(let box of boxes){
    if(box.querySelector(".item-data span").textContent.includes(market) &&
       box.querySelector(".item-data span:nth-child(3)").textContent.includes(item)){
      box.remove(); break;
    }
  }
}

// HISTORY
function saveToHistory(data){
  let history=JSON.parse(localStorage.getItem("history"))||[];
  history.push(data);
  localStorage.setItem("history",JSON.stringify(history));
}

function showHistory(){
  let history=JSON.parse(localStorage.getItem("history"))||[];
  historyDiv.innerHTML="";
  if(history.length===0){historyDiv.innerHTML="<p>No history found.</p>"; return;}
  historyDiv.innerHTML="<h3>ðŸ“… Daily History</h3>";
  history.slice().reverse().forEach((arr,index)=>{
    arr.forEach((entry)=>{
      const div=document.createElement("div");
      div.className="item-box";
      div.innerHTML=`
        <div class="item-data">
          <span><b>Market:</b> ${entry.market}</span>
          <span><b>Date:</b> ${entry.date}</span>
          <span><b>Item:</b> ${entry.item}</span>
          <span><b>Old:</b> ${entry.old}</span>
          <span><b>New:</b> ${entry.new}</span>
        </div>
        <div class="menu">
          <span class="menu-btn" onclick="toggleMenu(this)">â‹®</span>
          <div class="menu-content">
            <button onclick="deleteHistoryEntry(${history.length-1-index})">Delete</button>
            <button onclick="deleteAllHistory()">Delete All History</button>
          </div>
        </div>
      `;
      historyDiv.appendChild(div);
    });
  });
}

// DELETE HISTORY ENTRY
function deleteHistoryEntry(index){
  let history=JSON.parse(localStorage.getItem("history"))||[];
  history.splice(index,1);
  localStorage.setItem("history",JSON.stringify(history));
  showHistory();
}

// DELETE ALL HISTORY
function deleteAllHistory(){
  if(confirm("Delete all history?")){localStorage.removeItem("history"); historyDiv.innerHTML="<p>All history deleted.</p>"; animationBox.innerHTML="";}
}

// PLAY BUTTON CLICK
playBtn.addEventListener("click",()=>{
  const text=document.getElementById("input").value.trim();
  if(text===""){playAnimationData(initialData); return;}
  // Parse pasted text as new data
  let newData=[];
  const lines=text.split("\n");
  lines.forEach(line=>{
    const parts=line.split(",");
    if(parts.length===3){
      let market="Unknown"; // optional
      let date=new Date().toLocaleDateString();
      newData.push({market,date,item:parts[0].trim(),old:Number(parts[1]),new:Number(parts[2])});
    }
  });
  if(newData.length>0){
    playAnimationData(newData);
    saveToHistory(newData);
  }
});

historyBtn.addEventListener("click",showHistory);

// On page load, show initial data
playAnimationData(initialData);
</script>
</body>
</html>
